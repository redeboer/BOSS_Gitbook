<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BOSS Afterburner: README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BOSS Afterburner
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('README_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="README_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;The BOSS Afterburner</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;====================</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;[TOC]</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;**This repository is underdevelopment.** It has been set up as an unofficial extension to the BOSS analysis framework of the [BESIII collaboration](http://bes3.ihep.ac.cn &quot;Offical BESIII webpage&quot;) with two related purposes:</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;1. Serve as an accessible introduction and user guide to **BOSS**.</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;2. Provide basic tools to analyse and visualise output of **BOSS**.</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;If you do not have an IHEP networking account, it is therefore better to check out the official [Offline Software page](http://english.ihep.cas.cn/bes/doc/2247.html &quot;Offical BOSS webpage&quot;) of BESIII -- this framework can only be of use if you are a collaborator of this experiment and if you have access to the software of this collaboration. You can also have a look at the section [Further reading](#further-reading).</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;The MarkDown generated material on [this repository page](https://github.com/redeboer/BOSS_Afterburner) serves as a simple introduction. For more details, you can go to the [parallel Doxygen-generated webpage](https://redeboer.github.io/BOSS_Afterburner/ &quot;Doxygen page of the BOSS Afterburner&quot;) of the BOSS Afterburner.</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;See also @ref tips ([MarkDown](doxygen/tips.md)).</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;# Introduction</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;The [Beijing Spectrometer (BESIII)](http://bes3.ihep.ac.cn/) is a particle experiment situated at the [Beijing Electron-Positron Collider (BEPCII)](http://english.ihep.cas.cn/doc/1840.html). It is primarily designed to perform highly sensitive studies of light hadron and charm physics.</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;@todo Elaborate or refer to official pages</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;Output of the detector is analysed using the [BESIII Offline Software System (BOSS)](http://english.ihep.cas.cn/bes/doc/2247.html).</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;# The BOSS framework</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;## Organisation of the IHEP server</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;The IHEP server runs on [Scientific Linux CERN](https://linux.web.cern.ch/linux/scientific.shtml) (SLC). The server offers several versions. Usually, people use either SLC5, SLC6, or SLC7. The domain names for these are `lxslc7.ihep.ac.cn`, where the `7` in this case refers to SLC7. If you are running on Linux or a Linux terminal, the server can be easily accessed using:</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;   ssh -Y &lt;your user name&gt;@lxslc7.ihep.ac.cn</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;Here, the option `-Y` ensures *X11 forwarding*, allowing you to open graphical applications.</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;In Windows, there are some nice tools that allow you to access the server. First of all, to be able to use SSH, use will either have to use [PuTTY](https://www.putty.org/) or more extensive software like [Xmanager](https://www.netsarang.com/products/xmg_overview.html). You can also just search for some Linux terminals for Windows. In addition, I would recommend you to work with the (S)FTP client [WinSCP](https://winscp.net/eng/index.php). It allows you to easily navigate the file structure of the IHEP server and to quickly transfer---even synchronise---files up and down to your own computer.</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;When you have logged into the server, you usually start in your home (`~`) folder. Move to the root of the server (`cd /`) and you&#39;ll see that is a large number of other directories. A few of these directories contain space that is assigned to your user account. Here is an overview:</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;| Path                                   | Data quotum | Max. number of files  | Remark                  |</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;| -------------------------------------- |:-----------:|:---------------------:|:-----------------------:|</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;| `/afs/ihep.ac.cn/users/&lt;letter&gt;/$USER` |      500 MB |                    NA | home (`~`)              |</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;| `/besfs/users/$USER`                   |       50 GB |               300,000 |                         |</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;| `/ihepbatch/bes/$USER`                 |      200 MB |                    NA |                         |</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;| `/workfs/bes/$USER`                    |        5 GB |                50,000 | no `hep_sub` available  |</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;| `/scratchfs/bes/$USER`                 |      500 GB |                    NA | max. 2 weeks            |</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;Of course, here, and in what follows, `$USER` refers to your user name.</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;Some other important directories are the following:</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;- [BOSS Software directory](https://docbes3.ihep.ac.cn/~offlinesoftware/index.php/How_to_setup_BOSS_environment_on_lxslc)</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   + `/afs/ihep.ac.cn/bes3/offline/Boss` (also referred to with `$BesArea`)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;- [Raw data files](https://docbes3.ihep.ac.cn/~offlinesoftware/index.php/Raw_Data)</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;   + `/bes3fs/offline/data/raw`</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   + `/besfs2/offline/data/raw` (only rounds 3 and 6)</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   + `/besfs/offline/data/randomtrg` (random trigger data)</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;- [Reconstructed data sets](https://docbes3.ihep.ac.cn/~offlinesoftware/index.php/Production)</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   + `/besfs3/offline/data/`</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   + `/besfs2/offline/` (older versions)</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;These directories will be important later in this &#39;tutorial&#39;.</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;## Setup of your BOSS and Afterburner environment</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;***Note:** In it&#39;s current version, this tutorial assumes you use a `bash` terminal.*</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;I advise you to set up your environment in the same way I did. There are two main directories that you will be using: (1) the *work area* that contains your run scripts for **BOSS** and (2) the *BOSS Afterburner* repository. I placed the work area in my `ihepbatch` folder (see [Organisation of the IHEP server](#organisation-of-the-ihep-server)) and the BOSS Afterburner in my `besfs` folder. Data generated with **BOSS** through the work area scripts is written then to the `BOSS_Afterburner/data` directory on `besfs` (see later).</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;### (1) Set up your work area</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;@todo Test the procedure described below!</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;@todo Rewrite for TC shell.</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;You will be running your **BOSS** analyses from this folder. It contains a *Configuration Management Tool* folder (`cmthome`), which is used to set up path variables for **BOSS**, and a `workarea` folder where you develop your own **BOSS** packages (including the `jobOptions*.txt` files).</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;**Step 1:** Go to your *IHEP batch* folder:</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;   cd /ihepbatch/bes/$USER</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;At this stage, you&#39;ll have to decide which version of BOSS you have to use. At the time of writing, version 7.0.3 is the latest stable version, though it could be that for your analysis you have to use data sets that were reconstructed with older versions of **BOSS**. Here, I&#39;ll just use `7.0.3`, but you can replace this number with whatever version you need. </div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;**Step 2:** We&#39;ll first set up the necessary references to **BOSS** using the *Configuration Management Tool* (CMT). This is done by copying the `cmthome` folder from BOSS Software directory to the `ihepbatch` folder where you currently are:</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;   cp -R /afs/ihep.ac.cn/bes3/offline/Boss/cmthome/cmthome-7.0.3 .</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;and navigate into that copy:</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;   cd cmthome-7.0.3</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;**Step 3:** You&#39;ll now have to modify the file called `requirements` so that it handles your username properly. We&#39;ll use the `vi` editor here, but you can use whatever editor you prefer:</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   vi requirements</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;The file contains the following lines:</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   #macro WorkArea &quot;/ihepbatch/bes/maqm/workarea&quot;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   #path_remove CMTPATH &quot;${WorkArea}&quot;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   #path_prepend CMTPATH &quot;${WorkArea}&quot;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;Uncomment them (remove the hash `#`) and replace `maqm` with your own user name. Like this:</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   macro WorkArea &quot;/ihepbatch/bes/$USER/workarea&quot;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   path_remove CMTPATH &quot;${WorkArea}&quot;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   path_prepend CMTPATH &quot;${WorkArea}&quot;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;**Step 4:** Now you can use the scripts to set all references to **BOSS** at once using:</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   source setupCMT.sh  # starts connection to the CMT</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   cmt config          # initiates configuration</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;   source setup.sh     # sets path variables</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;Just to be sure, you can check whether the path variables have been set correctly:</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   echo $CMTPATH</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;If everything went well, it should print:</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;   /ihepbatch/bes/$USER/workarea-7.0.3:/afs/ihep.ac.cn/bes3/offline/Boss/7.0.3:/afs/ihep.ac.cn/bes3/offline/ExternalLib/SLC6/ExternalLib/gaudi/GAUDI_v23r9:/afs/ihep.ac.cn/bes3/offline/ExternalLib/SLC6/ExternalLib/LCGCMT/LCGCMT_65a</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;**Step 5:** Adapt your `bash` profile (`.bash_profile`) and *run commands* file (`.bashrc`) so that **BOSS** is loaded automatically every time you log into the server. The easy solution is simply copy-pasting and running these commands:</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;   echo -e &quot;if test -f .bashrc; then\n\tsource .bashrc\nfi&quot; &gt;&gt; ~/.bash_profile</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;   echo &quot;IHEPBATCH=\&quot;/ihepbatch/bes/$USER\&quot;&quot; &gt;&gt; ~/.bashrc</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   echo &quot;CMTHOME=\&quot;/afs/ihep.ac.cn/bes3/offline/Boss/cmthome/cmthome-7.0.3\&quot;&quot; &gt;&gt; ~/.bashrc</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   echo &quot;source $IHEPBATCH/cmthome-7.0.3/setupCMT.sh&quot; &gt;&gt; ~/.bashrc</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   echo &quot;source $IHEPBATCH/cmthome-7.0.3/setup.sh&quot; &gt;&gt; ~/.bashrc</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;   echo &quot;source $IHEPBATCH/workarea-7.0.3/TestRelease/TestRelease-00-00-86/cmt/setup.sh&quot; &gt;&gt; ~/.bashrc</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;   echo &quot;export PATH=$PATH:/afs/ihep.ac.cn/soft/common/sysgroup/hep_job/bin/&quot; &gt;&gt; ~/.bashrc</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;However, to avoid becoming a [copy ninja](https://pics.me.me/kakashi-went-from-the-copy-ninja-to-the-copy-paste-14969048.png &quot;Kakashi programming&quot;), you&#39;d better modify these files yourself. First, add these lines to your bash profile (`vi ~/bash_profile`):</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;   if test -f .bashrc; then</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;       source .bashrc</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   fi</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;These lines force the server to load your `.bashrc` run commands file. In that file, you should add the following lines:</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;   IHEPBATCH=&quot;/ihepbatch/bes/$USER&quot;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;   CMTHOME=&quot;/afs/ihep.ac.cn/bes3/offline/Boss/cmthome/cmthome-7.0.3&quot;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   source $IHEPBATCH/cmthome-7.0.3/setupCMT.sh</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;   source $IHEPBATCH/cmthome-7.0.3/setup.sh</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;   source $IHEPBATCH/workarea-7.0.3/TestRelease/TestRelease-00-00-86/cmt/setup.sh</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;   export PATH=$PATH:/afs/ihep.ac.cn/soft/common/sysgroup/hep_job/bin/</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;Notice that the commands we used in step 4 are used here again. There is also a reference to the `workarea` (see step 7). The last line allows you to submit **BOSS** jobs to the queue---for now, don&#39;t worry what this means.</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;You can now either log in again to the server or use `source ~/.bashrc` to reload the run commands.</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;**Step 6:** To test whether everything went correctly, you can try to run **BOSS**:</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   boss.exe</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;It should result in a (trivial) error message like this:</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;   **************************************************</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                  BOSS version: 7.0.3</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;   ************** BESIII Collaboration **************</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;   the jobOptions file is : jobOptions.txt</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;   ERROR! the jobOptions file is empty!</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;**Step 7:** It is convention to place your **BOSS** packages in a *workarea* folder next to the `cmthome` folder we have been using so far. Let&#39;s create it:</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;   cd /ihepbatch/bes/$USER</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;   mkdir workarea-7.0.3</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;We&#39;ll get back to this folder when we [set up a BOSS package](#set-up-a-boss-package).</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;### (2) Set up the BOSS Afterburner</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;This is the simple part. Go to the *BES file system* folder:</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   cd /besfs/users/$USER</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;[Clone](https://help.github.com/articles/cloning-a-repository/) the *BOSS Afterburner* repository:</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   git clone https://github.com/redeboer/BOSS_Afterburner</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;The *BOSS Aafterburner* will be used to analyse output from **BOSS**.</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;## Set up a BOSS package</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;Now that you have configured your **BOSS** work area, you can start developing packages. The typical example package to get you started is the `TestRelease` package. We will need to copy this package into your [your work area](#set-up-your-work-area). So let&#39;s navigate there:</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;   cd /ihepbatch/bes/$USER/workarea-7.0.3</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;Now copy the typical `TestRelease` example to your *work area* and navigate into it:</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   cp â€“r $BesArea/TestRelease ./</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;   cd TestRelease/TestRelease-*</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;You are now in a folder like `TestRelease/TestRelease-00-00-86`, where `00-00-86` represents the version. Using `ls`, you can see that it contains some folders:</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;- `cmt`: the *Configuration Management Tool* that you will use to connect to **BOSS**</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;- `CVS`: a folder used when generating documentation</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;- `run`: which contains the `jobOptions` that are run with `boss.exe`</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;We can set up the `TestRelease` by going into `cmt` and &#39;broadcasting&#39; to **BOSS** from there:</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   cd cmt</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;   cmt broadcast cmt config</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;   cmt broadcast make</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   source setup.sh</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;This will initialise the package so that you can run it from the run folder. This is done using `boss.exe`:</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   cd ../run</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   boss.exe jobOptions_sim.txt</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;which, in this case, will run a Monte Carlo simulation.</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;Note that in step 7 [when we set up the work area](#set-up-your-work-area) we added a line to the `.bashrc` that ensures that the `TestRelease` package is laoded every time you log in, so you won&#39;t have to do this every time yourself.</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;## Running a job</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;Particile physicists perform analyses on either data from measurements or on data from Monte Carlo simulation. In **BOSS**, it is possible to generate your own Monte Carlo simulations and to treat its output as ordinary data. There are there for three basic steps in running a Monte Carlo job on **BOSS**:</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;1. `sim`: you perform a Monte Carlo simulation and generate a raw data file (`rtraw`)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;2. `rec`: you reconstruct particle tracks from the raw data and write out a reconstructed data file (`dst`)</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;3. `ana`: you analyse the reconstructed tracks and generate a [CERN ROOT](https://root.cern.ch/input-and-output) file containing trees that describe event and track variables (`root`)</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;When you are analysing measurement data, you won&#39;t have to perform steps 1 and 2: the BESIII collaboration reconstructs all data samples whenever a new version of BOSS is released. (See [Organisation of the IHEP server](organisation-of-the-ihep-server), under &quot;Reconstructed data sets&quot;, for where these files are located.)</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;The steps are performed from your the `jobOptions*.txt` files of your own package in your work area. As an example, you can run the `jobOptions` in in the `TestRelease` package:</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   cd /ihepbatch/bes/$USER/TestRelease/TestRelease-*/run/</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;   boss.exe jobOptions_sim.txt</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   boss.exe jobOptions_rec.txt</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;   boss.exe jobOptions_ana_rhopi.txt</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;But be careful: for these jobs to work successfully, you will probably have to edit them and set the right paths.</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;## Submitting a job</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;The `TestRelease` example typically simulates, reconstructes, and analyses only 10 events. For serious work, it you will have to generate thousands of events and this will take a long time. You can therefore submit your job to a so-called &#39;queque&#39;. For this, there are two options: either you submit them using the command `hep_sub` or using the command `boss.conder`. The latter is easiest: you can use it just like `boss.exe`.</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;With `hep_sub`, however, you essentially forward a shell script to the queue, which then executes the commands in there. So you&#39;ll have to make that first. Let&#39;s say, you make a shell script `test.sh` in the `run` folder that looks like this:</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   #!/bin/bash</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   boss.exe jobOptions_sim.txt</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;The first line clarifies that you use `bash`, the second does what you did when running a job: calling `boss.exe`, but of course, you can make this script to execute whatever `bash` commands you want.</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;@todo Not sure if you should `chmod +x` it?</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;Now you can simply submit the shell script to the queue using:</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;   hep_sub test.sh -g physics</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;and it will be executed in the background. Here, the option `-g` tellst that you are from the `physics` group. You can check whether the job is (still) running in the queue using:</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   hep_q -u $USER</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;Note that `hep_q` would list all jobs from all users.</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;## Splitting up jobs</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;Jobs that take a long time to be executed in the queue will be killed by the server. It is therefore recommended that you analyse a maximum of **10,000 events** per job, particularly if you perform Monte Carlo simulations. Of course, you will be wanting to work with much larger data samples, sou you will have to submit parallel jobs. This can be done by writing different `jobOptions*.txt` files, where you modify the input/output file and random seed number.</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;What is much more convenient, however, is developing a `jobOptions*.txt` template file that is used to generate. In these, you for instance replace the specific paths and seed number you used by generic tokens like `INPUTFILE`, `OUTPUTFILE`, and `RANDOMSEED`. You can then use a `bash` script (or comparable shell scripts) to replace these tokens by unique paths and seed numbers. For example, have a look at the [`awk`](https://www.tldp.org/LDP/abs/html/awk.html) command.</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;# Further reading</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;## IHEP and the BESIII collaboration</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;- BESIII:</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   - http://bes3.ihep.ac.cn/</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   - http://bes.ihep.ac.cn/</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;- IHEP: </div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   - http://english.ihep.cas.cn/ [English]</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   - http://www.ihep.cas.cn/ [Chinese]</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   - http://web.ihep.ac.cn/</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;- http://english.ihep.cas.cn/doc/259.html</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;## The BOSS Analysis Framework</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;- BOSS software source code CVS repository:</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   - [for users inside IHEP](http://koala.ihep.ac.cn/cgi-bin/viewcvs.cgi/BossCvs/)</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   - [for users outside IHEP](http://docbes3.ihep.ac.cn/viewvc/cgi-bin/viewvc.cgi/BESIII/BossCvs/)</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;- Doxygen documentation:</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   - http://bes3.to.infn.it/Boss/7.0.2/html/classes.html (external)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;   - https://boss.ihep.ac.cn/~offlinesoftware/MdcPatRecDoc04/classes.html (`MdcPatRec` Class Index)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;- http://twiki.ihep.ac.cn/twiki/view/BES/BOSS/WebHome (TWiki)</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;- https://indico.cern.ch/event/408139/contributions/979815/attachments/815741/1117758/CHEP06-Weidong_Li.pdf</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;# About</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;From October 2018 to May 2019, I will be doing my master research at the BESIII Collaboration as a visiting master student from Utrecht University (The Netherlands). Because I, like many others, will spend a lot of time getting used to the **BOSS** framework, I decided to supply the code I write for my own analysis with `Doxygen` formated comments. The resulting documentation can then be used as a guide for anyone who wants to get familiar with the **BOSS** framework.</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;In writing my code, I have attempted to set up an object-oriented `C++` class structure that is both general in usage (that is, using *base and derived classes*) and represents the data structure of analysis output from the **BOSS** framework. In this way, I hope that the class documentation in this repository can also be used to help the user understand the **BOSS** framework itself.</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="README_8md.html">README.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
