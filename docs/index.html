<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>BOSS Afterburner: The BOSS Afterburner</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BOSS Afterburner
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">The BOSS Afterburner </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>This repository is underdevelopment.</b> It has been set up as an <em>unofficial</em> extension to the BOSS analysis framework of the <a href="http://bes3.ihep.ac.cn" title="Offical BESIII webpage">BESIII collaboration</a> with two related purposes:</p>
<ol type="1">
<li>Serve as an accessible introduction and user guide to <b>BOSS</b>.</li>
<li>Provide basic tools to analyse and visualise output of <b>BOSS</b>.</li>
</ol>
<p>If you do not have an IHEP networking account, it is therefore better to check out the official <a href="http://english.ihep.cas.cn/bes/doc/2247.html" title="Offical BOSS webpage">Offline Software page</a> of BESIII &mdash; this framework can only be of use if you are a collaborator of this experiment and if you have access to the software of this collaboration. You can also have a look at the section <a href="#further-reading">Further reading</a>.</p>
<p>The MarkDown generated material on this repository page serve as a simple introduction. For more details, you can go to the <a href="https://redeboer.github.io/BOSS_Afterburner/" title="Doxygen page of the BOSS Afterburner">parallel Doxygen generated webpage</a> of the BOSS Afterburner.</p>
<h1>Table of contents </h1>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#the-boss-framework">The BOSS framework</a><ul>
<li><a href="#organisation-of-the-ihep-server">Organisation of the IHEP server</a></li>
<li><a href="#setup-of-your-boss-and-afterburner-environment">Setup of your BOSS and Afterburner environment</a></li>
<li><a href="#set-up-a-boss-package">Set up a BOSS package</a></li>
</ul>
</li>
<li><a href="#further-reading">Further reading</a><ul>
<li><a href="#the-boss-analysis-framework">The BOSS Analysis Framework</a></li>
</ul>
</li>
<li><a href="#about">About</a></li>
</ul>
<h1>Introduction</h1>
<p>The <a href="http://bes3.ihep.ac.cn/">Beijing Spectrometer (BESIII)</a> is a particle experiment situated at the <a href="http://english.ihep.cas.cn/doc/1840.html">Beijing Electron-Positron Collider (BEPCII)</a>. It is primarily designed to perform highly sensitive studies of light hadron and charm physics.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd><p class="startdd">Elaborate or refer </p>
<p class="enddd">Rewrite for TC shell.</p>
</dd></dl>
<p>Output of the detector is analysed using the <a href="http://english.ihep.cas.cn/bes/doc/2247.html">BESIII Offline Software System (BOSS)</a>.</p>
<h1>The BOSS framework</h1>
<h2>Organisation of the IHEP server</h2>
<p>The IHEP server runs on <a href="https://linux.web.cern.ch/linux/scientific.shtml">Scientific Linux CERN</a> (SLC). The server offers several versions. Usually, people use either SLC5, SLC6, or SLC7. The domain names for these are <code>lxslc7.ihep.ac.cn</code>, where the <code>7</code> in this case refers to SLC7. If you are running on Linux or a Linux terminal, the server can be easily accessed using: </p>
<pre class="fragment">ssh -Y &lt;your user name&gt;@lxslc7.ihep.ac.cn
</pre><p>Here, the option <code>-Y</code> ensures <em>X11 forwarding</em>, allowing you to open graphical applications.</p>
<p>In Windows, there are some nice tools that allow you to access the server. First of all, to be able to use SSH, use will either have to use <a href="https://www.putty.org/">PuTTY</a> or more extensive software like <a href="https://www.netsarang.com/products/xmg_overview.html">Xmanager</a>. You can also just search for some Linux terminals for Windows. In addition, I would recommend you to work with the (S)FTP client <a href="https://winscp.net/eng/index.php">WinSCP</a>. It allows you to easily navigate the file structure of the IHEP server and to quickly transfer&mdash;even synchronise&mdash;files up and down to your own computer.</p>
<p>When you have logged into the server, you usually start in your home (<code>~</code>) folder. Move to the root of the server (<code>cd /</code>) and you'll see that is a large number of other directories. A few of these directories contain space that is assigned to your user account. Here is an overview:</p>
<table class="doxtable">
<tr>
<th>Path </th><th align="center">Data quotum </th><th align="center">Max. number of files </th><th align="center">Remark  </th></tr>
<tr>
<td><code>/afs/ihep.ac.cn/users/&lt;letter&gt;/$USER</code> </td><td align="center">500 MB </td><td align="center">NA </td><td align="center">home (<code>~</code>) </td></tr>
<tr>
<td><code>/besfs/users/$USER</code> </td><td align="center">50 GB </td><td align="center">300,000 </td><td align="center"></td></tr>
<tr>
<td><code>/ihepbatch/bes/$USER</code> </td><td align="center">200 MB </td><td align="center">NA </td><td align="center"></td></tr>
<tr>
<td><code>/workfs/bes/$USER</code> </td><td align="center">5 GB </td><td align="center">50,000 </td><td align="center">no <code>hep_sup</code> available </td></tr>
<tr>
<td><code>/scratchfs/bes/$USER</code> </td><td align="center">500 GB </td><td align="center">NA </td><td align="center">max. 2 weeks </td></tr>
</table>
<p>Some other important directories are the following:</p>
<ul>
<li><a href="https://docbes3.ihep.ac.cn/~offlinesoftware/index.php/How_to_setup_BOSS_environment_on_lxslc">BOSS Software directory</a><ul>
<li><code>/afs/ihep.ac.cn/bes3/offline/Boss</code></li>
</ul>
</li>
<li><a href="https://docbes3.ihep.ac.cn/~offlinesoftware/index.php/Raw_Data">Raw data files</a><ul>
<li><code>/bes3fs/offline/data/raw</code></li>
<li><code>/besfs2/offline/data/raw</code> (only rounds 3 and 6)</li>
<li><code>/besfs/offline/data/randomtrg</code> (random trigger data)</li>
</ul>
</li>
<li><a href="https://docbes3.ihep.ac.cn/~offlinesoftware/index.php/Production">Reconstructed data sets</a><ul>
<li><code>/besfs3/offline/data/</code></li>
<li><code>/besfs2/offline/</code> (older versions)</li>
</ul>
</li>
</ul>
<p>These directories will be important later in this 'tutorial'.</p>
<h2>Setup of your BOSS and Afterburner environment</h2>
<p>***Note:** In it's current version, this tutorial assumes you use a <code>bash</code> terminal.*</p>
<p>I advise you to set up your environment in the same way I did. There are two main directories that you will be using: (1) the <em>work area</em> that contains your run scripts for <b>BOSS</b> and (2) the <em>BOSS Afterburner</em> repository. I placed the work area in my <code>ihepbatch</code> folder (see <a href="#organisation-of-the-ihep-server">Organisation of the IHEP server</a>) and the BOSS Afterburner in my <code>besfs</code> folder. Data generated with <b>BOSS</b> through the work area scripts is written then to the <code>BOSS_Afterburner/data</code> directory on <code>besfs</code> (see later).</p>
<h3>(1) Set up your work area</h3>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>Test the procedure described below! </dd></dl>
<p>You will be running your <b>BOSS</b> analyses from this folder. It contains a <em>Configuration Management Tool</em> folder (<code>cmthome</code>), which is used to set up path variables for <b>BOSS</b>, and a <code>workarea</code> folder where you develop your own <b>BOSS</b> packages (including the <code>jobOptions*.txt</code> files).</p>
<p><b>Step 1:</b> Go to your <em>IHEP batch</em> folder: </p>
<pre class="fragment">cd /ihepbatch/bes/&lt;your username&gt;
</pre><p>At this stage, you'll have to decide which version of BOSS you have to use. At the time of writing, version 7.0.3 is the latest stable version, though it could be that for your analysis you have to use data sets that were reconstructed with older versions of <b>BOSS</b>. Here, I'll just use <code>7.0.3</code>, but you can replace this number with whatever version you need.</p>
<p><b>Step 2:</b> We'll first set up the necessary references to <b>BOSS</b> using the <em>Configuration Management Tool</em> (CMT). This is done by copying the <code>cmthome</code> folder from BOSS Software directory to the <code>ihepbatch</code> folder where you currently are: </p>
<pre class="fragment">cp -R /afs/ihep.ac.cn/bes3/offline/Boss/cmthome/cmthome-7.0.3 .
</pre><p>and navigate into that copy: </p>
<pre class="fragment">cd cmthome-7.0.3
</pre><p><b>Step 3:</b> You'll now have to modify the file called <code>requirements</code> so that it handles your username properly. We'll use the <code>vi</code> editor here, but you can use whatever editor you prefer: </p>
<pre class="fragment">vi requirements
</pre><p>The file contains the following lines: </p>
<pre class="fragment">#macro WorkArea "/ihepbatch/bes/maqm/workarea"

#path_remove CMTPATH "${WorkArea}"
#path_prepend CMTPATH "${WorkArea}"
</pre><p>Uncomment them (remove the hash <code>#</code>) and replace <code>maqm</code> with your own user name. Like this: </p>
<pre class="fragment">macro WorkArea "/ihepbatch/bes/$USER/workarea"

path_remove CMTPATH "${WorkArea}"
path_prepend CMTPATH "${WorkArea}"
</pre><p><b>Step 4:</b> Now you can use the scripts to set all references to <b>BOSS</b> at once using: </p>
<pre class="fragment">source setupCMT.sh  # starts connection to the CMT
cmt config          # initiates configuration
source setup.sh     # sets path variables
</pre><p>Just to be sure, you can check whether the path variables have been set correctly: </p>
<pre class="fragment">echo $CMTPATH
</pre><p>If everything went well, it should print: </p>
<pre class="fragment">/ihepbatch/bes/$USER/workarea-7.0.3:/afs/ihep.ac.cn/bes3/offline/Boss/7.0.3:/afs/ihep.ac.cn/bes3/offline/ExternalLib/SLC6/ExternalLib/gaudi/GAUDI_v23r9:/afs/ihep.ac.cn/bes3/offline/ExternalLib/SLC6/ExternalLib/LCGCMT/LCGCMT_65a
</pre><p><b>Step 5:</b> Adapt your <code>bash</code> profile (<code>.bash_profile</code>) and <em>run commands</em> file (<code>.bashrc</code>) so that <b>BOSS</b> is loaded automatically every time you log into the server. The easy solution is simply copy-pasting and running these commands: </p>
<pre class="fragment">echo -e "if test -f .bashrc; then\n\tsource .bashrc\nfi" &gt;&gt; ~/.bash_profile
echo "IHEPBATCH=\"/ihepbatch/bes/$USER\"" &gt;&gt; ~/.bashrc
echo "CMTHOME=\"/afs/ihep.ac.cn/bes3/offline/Boss/cmthome/cmthome-7.0.3\"" &gt;&gt; ~/.bashrc
echo "source $IHEPBATCH/cmthome-7.0.3/setupCMT.sh" &gt;&gt; ~/.bashrc
echo "source $IHEPBATCH/cmthome-7.0.3/setup.sh" &gt;&gt; ~/.bashrc
echo "source $IHEPBATCH/workarea-7.0.3/TestRelease/TestRelease-00-00-86/cmt/setup.sh" &gt;&gt; ~/.bashrc
echo "export PATH=$PATH:/afs/ihep.ac.cn/soft/common/sysgroup/hep_job/bin/" &gt;&gt; ~/.bashrc
</pre><p>However, to avoid becoming a <a href="https://pics.me.me/kakashi-went-from-the-copy-ninja-to-the-copy-paste-14969048.png" title="Kakashi programming">copy ninja</a>, you'd better modify these files yourself. First, add these lines to your bash profile (<code>vi ~/bash_profile</code>): </p>
<pre class="fragment">if test -f .bashrc; then
    source .bashrc
fi
</pre><p>These lines force the server to load your <code>.bashrc</code> run commands file. In that file, you should add the following lines: </p>
<pre class="fragment">IHEPBATCH="/ihepbatch/bes/$USER"
CMTHOME="/afs/ihep.ac.cn/bes3/offline/Boss/cmthome/cmthome-7.0.3"
source $IHEPBATCH/cmthome-7.0.3/setupCMT.sh
source $IHEPBATCH/cmthome-7.0.3/setup.sh
source $IHEPBATCH/workarea-7.0.3/TestRelease/TestRelease-00-00-86/cmt/setup.sh
export PATH=$PATH:/afs/ihep.ac.cn/soft/common/sysgroup/hep_job/bin/
</pre><p>You can now either log in again to the server or use <code>source ~/.bashrc</code> to reload the run commands.</p>
<p><b>Step 6:</b> You're done! To test whether everything went correctly, you can try to run <b>BOSS</b>: </p>
<pre class="fragment">boss.exe
</pre><p>It should result in a (trivial) error message like this: </p>
<pre class="fragment">**************************************************
               BOSS version: 7.0.3
************** BESIII Collaboration **************

the jobOptions file is : jobOptions.txt
ERROR! the jobOptions file is empty!
</pre><h3>(2) Set up the BOSS Afterburner</h3>
<p>Go to the <em>BES file system</em> folder: </p>
<pre class="fragment">cd /besfs/users/$USER
</pre><p><a href="https://help.github.com/articles/cloning-a-repository/">Clone</a> the <em>BOSS Afterburner</em> repository: </p>
<pre class="fragment">git clone https://github.com/redeboer/BOSS_Afterburner
</pre><p>Now you're all set to go!</p>
<h2>Set up a BOSS package</h2>
<p>The typical example that is used as a starting point in <b>BOSS</b> is the <code>TestRelease</code> package. We will need to copy this package into your work area.</p>
<p>First go to <a href="#your-work-area">your work area</a>: </p>
<pre class="fragment">cd /ihepbatch/bes/$USER



cp â€“r $BesArea/TestRelease ./
</pre><ol type="1">
<li><code>cd TestRelease/TestRelease-*/cmt</code></li>
<li><code>cmt broadcast cmt config</code></li>
<li><code>cmt broadcast make</code></li>
<li><code>source setup.csh</code></li>
</ol>
<h1>Further reading</h1>
<h2>The BOSS Analysis Framework</h2>
<ul>
<li>BOSS software source code CVS repository:<ul>
<li><a href="http://koala.ihep.ac.cn/cgi-bin/viewcvs.cgi/BossCvs/">for users inside IHEP</a></li>
<li><a href="http://docbes3.ihep.ac.cn/viewvc/cgi-bin/viewvc.cgi/BESIII/BossCvs/">for users outside IHEP</a></li>
</ul>
</li>
<li>Doxygen documentation:<ul>
<li><a href="http://bes3.to.infn.it/Boss/7.0.2/html/classes.html">http://bes3.to.infn.it/Boss/7.0.2/html/classes.html</a> (external)</li>
<li><a href="https://boss.ihep.ac.cn/~offlinesoftware/MdcPatRecDoc04/classes.html">https://boss.ihep.ac.cn/~offlinesoftware/MdcPatRecDoc04/classes.html</a> (<code>MdcPatRec</code> Class Index)</li>
</ul>
</li>
<li><a href="http://twiki.ihep.ac.cn/twiki/view/BES/BOSS/WebHome">http://twiki.ihep.ac.cn/twiki/view/BES/BOSS/WebHome</a> (TWiki)</li>
<li><a href="https://indico.cern.ch/event/408139/contributions/979815/attachments/815741/1117758/CHEP06-Weidong_Li.pdf">https://indico.cern.ch/event/408139/contributions/979815/attachments/815741/1117758/CHEP06-Weidong_Li.pdf</a></li>
</ul>
<h1>About</h1>
<p>From October 2018 to May 2019, I will be doing my master research at the BESIII Collaboration as a visiting master student from Utrecht University (The Netherlands). Because I, like many others, will spend a lot of time getting used to the <b>BOSS</b> framework, I decided to supply the code I write for my own analysis with <code>Doxygen</code> formated comments. The resulting documentation can then be used as a gudie for anyone who wants to get familiar with the <b>BOSS</b> framework.</p>
<p>In writing my code, I have attempted to set up an object-oriented <code>C++</code> class structure that is both general in usage (that is, using <em>base and derived classes</em>) and represents the data structure of analysis output from the <b>BOSS</b> framework. In this way, I hope that class documentation in this repository can also be used to help the user understand the <b>BOSS</b> framework itself. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
